#!/usr/bin/env bash

set -e
set -o pipefail

echo "Setting up Trusted NPM registry."

readonly BUILD_DIR=$1
readonly CLEAN_FILES=.slug-post-clean

if [[ ! -n "${BUILD_DIR}" ]]; then
  echo "No build directory specified - exiting"
  exit 1
fi

cd ${BUILD_DIR}

echo 'npmScopes:' >> ~/.yarnrc.yml
echo '  trusted:' >> ~/.yarnrc.yml
echo '    npmAuthToken: "${GITHUB_NPM_TOKEN}"' >> ~/.yarnrc.yml
echo '    npmRegistryServer: "https://npm.pkg.github.com"' >> ~/.yarnrc.yml
echo '  fortawesome:' >> ~/.yarnrc.yml
echo '    npmAuthToken: "${FONTAWESOME_NPM_TOKEN}"' >> ~/.yarnrc.yml
echo '    npmRegistryServer: "https://npm.fontawesome.com/"' >> ~/.yarnrc.yml

exit 0
